<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Object Scanner with Real Point Clouds</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            color: white;
            min-height: 100vh;
            overflow-x: hidden;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            padding: 20px 0;
            margin-bottom: 30px;
        }
        
        h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .scanner-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .camera-feed, .preview {
            flex: 1;
            min-width: 300px;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
            position: relative;
        }
        
        .camera-placeholder, #preview-canvas {
            width: 100%;
            height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #111;
        }
        
        #camera-video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transform: scaleX(-1); /* Mirror the camera feed */
        }
        
        .capture-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 231, 246, 0.3);
            display: none;
            justify-content: center;
            align-items: center;
            font-size: 3rem;
            font-weight: bold;
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            padding: 20px;
            flex-wrap: wrap;
        }
        
        button {
            padding: 12px 25px;
            border: none;
            border-radius: 50px;
            background: linear-gradient(to right, #3494E6, #EC6EAD);
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.25);
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 14px rgba(0, 0, 0, 0.3);
        }
        
        button:active {
            transform: translateY(1px);
        }
        
        #scan-btn {
            background: linear-gradient(to right, #00b09b, #96c93d);
        }
        
        #reset-btn {
            background: linear-gradient(to right, #ff5e62, #ff9966);
        }
        
        .object-selector {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .object-btn {
            padding: 10px 20px;
            border: 2px solid #00e7f6;
            border-radius: 30px;
            background: transparent;
            color: #00e7f6;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .object-btn:hover, .object-btn.active {
            background: #00e7f6;
            color: #0a0a0b;
        }
        
        .instructions {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            line-height: 1.6;
        }
        
        .instructions h2 {
            margin-bottom: 10px;
            color: #00e7f6;
        }
        
        .instructions ol {
            padding-left: 20px;
            margin-bottom: 15px;
        }
        
        .instructions li {
            margin-bottom: 10px;
        }
        
        .status {
            text-align: center;
            padding: 10px;
            font-weight: bold;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 5px;
            margin-top: 10px;
        }
        
        .progress-bar {
            height: 10px;
            background: #333;
            border-radius: 5px;
            margin: 10px 0;
            overflow: hidden;
        }
        
        .progress {
            height: 100%;
            background: linear-gradient(to right, #00b09b, #96c93d);
            width: 0%;
            transition: width 0.5s;
        }
        
        .capture-points {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-top: 10px;
        }
        
        .capture-point {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #666;
        }
        
        .capture-point.active {
            background: #00e7f6;
            box-shadow: 0 0 10px #00e7f6;
        }
        
        footer {
            text-align: center;
            padding: 20px;
            margin-top: 30px;
            opacity: 0.8;
        }
        
        @media (max-width: 768px) {
            .scanner-container {
                flex-direction: column;
            }
            
            h1 {
                font-size: 2.2rem;
            }
            
            .controls {
                flex-direction: column;
                align-items: center;
            }
            
            button {
                width: 100%;
                max-width: 250px;
            }
            
            .object-selector {
                flex-direction: column;
                align-items: center;
            }
            
            .object-btn {
                width: 100%;
                max-width: 200px;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>3D Object Scanner with Point Clouds</h1>
            <p class="subtitle">Capture different object shapes as 3D point clouds</p>
        </header>
        
        <div class="object-selector">
            <button class="object-btn active" data-shape="box">Box</button>
            <button class="object-btn" data-shape="sphere">Sphere</button>
            <button class="object-btn" data-shape="cylinder">Cylinder</button>
            <button class="object-btn" data-shape="cone">Cone</button>
            <button class="object-btn" data-shape="torus">Torus</button>
        </div>
        
        <div class="scanner-container">
            <div class="camera-feed">
                <h2>Camera Feed</h2>
                <div class="camera-placeholder" id="camera-container">
                    <p>Camera access required for scanning</p>
                </div>
                <div class="capture-points">
                    <div class="capture-point" id="point-1"></div>
                    <div class="capture-point" id="point-2"></div>
                    <div class="capture-point" id="point-3"></div>
                    <div class="capture-point" id="point-4"></div>
                    <div class="capture-point" id="point-5"></div>
                </div>
                <div class="progress-bar">
                    <div class="progress" id="scan-progress"></div>
                </div>
                <div class="status" id="status">Ready to scan</div>
            </div>
            
            <div class="preview">
                <h2>3D Point Cloud</h2>
                <div id="preview-canvas"></div>
                <div class="status" id="render-status">No point cloud generated yet</div>
            </div>
        </div>
        
        <div class="controls">
            <button id="start-btn">Start Camera</button>
            <button id="scan-btn">Scan Object</button>
            <button id="reset-btn">Reset</button>
            <button id="export-btn">Export Point Cloud</button>
        </div>
        
        <div class="instructions">
            <h2>What is a 3D Point Cloud?</h2>
            <p>A 3D point cloud is a collection of data points in space, representing the external surface of an object. Each point has:</p>
            <ul>
                <li>X, Y, Z coordinates (position in 3D space)</li>
                <li>Color information (if captured with color)</li>
                <li>Sometimes additional attributes like intensity or normal vectors</li>
            </ul>
            <p>Point clouds are created by 3D scanners (like LiDAR) or through photogrammetry. In this demo, we're simulating the process by generating different point cloud shapes based on the object type you select.</p>
            
            <h2>How to Use This Scanner</h2>
            <ol>
                <li>Select an object shape from the options above</li>
                <li>Click "Start Camera" to enable your device's camera</li>
                <li>Click "Scan Object" - the scanner will capture multiple angles</li>
                <li>Wait for the 3D point cloud to generate on the right side</li>
                <li>Use "Export Point Cloud" to download the data (simulated)</li>
                <li>Use "Reset" to clear the current scan and start over</li>
            </ol>
        </div>
    </div>
    
    <footer>
        <p>3D Point Cloud Scanner | Created with Three.js</p>
    </footer>

    <script>
        // Variables for the 3D scene
        let scene, camera, renderer, pointCloud;
        let isScanning = false;
        let scanProgress = 0;
        let videoStream = null;
        let captureCount = 0;
        let selectedShape = "box";
        
        // Initialize the 3D preview
        function init3DPreview() {
            // Set up the scene
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x1a1a2e);
            
            // Set up the camera
            camera = new THREE.PerspectiveCamera(75, 
                document.getElementById('preview-canvas').offsetWidth / 
                document.getElementById('preview-canvas').offsetHeight, 
                0.1, 1000
            );
            camera.position.z = 5;
            
            // Set up the renderer
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(
                document.getElementById('preview-canvas').offsetWidth,
                document.getElementById('preview-canvas').offsetHeight
            );
            document.getElementById('preview-canvas').appendChild(renderer.domElement);
            
            // Add some lights
            const ambientLight = new THREE.AmbientLight(0x404040);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(1, 1, 1);
            scene.add(directionalLight);
            
            // Add a grid helper
            const gridHelper = new THREE.GridHelper(10, 10);
            scene.add(gridHelper);
            
            // Add axes helper
            const axesHelper = new THREE.AxesHelper(2);
            scene.add(axesHelper);
            
            // Initial render
            animate();
        }
        
        // Animation loop
        function animate() {
            requestAnimationFrame(animate);
            
            if (pointCloud) {
                pointCloud.rotation.y += 0.005;
            }
            
            renderer.render(scene, camera);
        }
        
        // Start the camera
        async function startCamera() {
            try {
                // Request camera access
                videoStream = await navigator.mediaDevices.getUserMedia({ 
                    video: { 
                        facingMode: 'environment',
                        width: { ideal: 1280 },
                        height: { ideal: 720 }
                    }, 
                    audio: false 
                });
                
                // Create video element and add to page
                const cameraContainer = document.getElementById('camera-container');
                cameraContainer.innerHTML = '';
                
                const video = document.createElement('video');
                video.id = 'camera-video';
                video.srcObject = videoStream;
                video.autoplay = true;
                video.playsInline = true;
                
                cameraContainer.appendChild(video);
                
                document.getElementById('status').textContent = 'Camera active - Position your object';
                
            } catch (error) {
                console.error('Error accessing camera:', error);
                document.getElementById('status').textContent = 'Camera access denied. Please allow camera permissions.';
            }
        }
        
        // Stop the camera
        function stopCamera() {
            if (videoStream) {
                videoStream.getTracks().forEach(track => track.stop());
                videoStream = null;
            }
            
            const cameraContainer = document.getElementById('camera-container');
            cameraContainer.innerHTML = '<p>Camera access required for scanning</p>';
        }
        
        // Generate different point cloud shapes
        function generatePointCloud(shape) {
            // Clear any existing point cloud
            if (pointCloud) {
                scene.remove(pointCloud);
            }
            
            const points = [];
            const colors = [];
            
            // Generate different point distributions based on shape
            switch(shape) {
                case "box":
                    // Box shape - points distributed on a cube
                    for (let i = 0; i < 2000; i++) {
                        const x = (Math.random() - 0.5) * 2;
                        const y = (Math.random() - 0.5) * 2;
                        const z = (Math.random() - 0.5) * 2;
                        
                        // Make points lie on the surface of a cube
                        if (Math.abs(x) > 0.8 || Math.abs(y) > 0.8 || Math.abs(z) > 0.8) {
                            points.push(x, y, z);
                            colors.push(
                                (x + 1) / 2,
                                (y + 1) / 2,
                                (z + 1) / 2
                            );
                        }
                    }
                    break;
                    
                case "sphere":
                    // Sphere shape - points distributed on a sphere
                    for (let i = 0; i < 2000; i++) {
                        const theta = Math.random() * Math.PI * 2;
                        const phi = Math.acos(2 * Math.random() - 1);
                        const r = 1;
                        
                        const x = r * Math.sin(phi) * Math.cos(theta);
                        const y = r * Math.sin(phi) * Math.sin(theta);
                        const z = r * Math.cos(phi);
                        
                        points.push(x, y, z);
                        colors.push(
                            (x + 1) / 2,
                            (y + 1) / 2,
                            (z + 1) / 2
                        );
                    }
                    break;
                    
                case "cylinder":
                    // Cylinder shape - points distributed on a cylinder
                    for (let i = 0; i < 2000; i++) {
                        const theta = Math.random() * Math.PI * 2;
                        const h = (Math.random() - 0.5) * 2;
                        const r = 1;
                        
                        const x = r * Math.cos(theta);
                        const y = h;
                        const z = r * Math.sin(theta);
                        
                        points.push(x, y, z);
                        colors.push(
                            (x + 1) / 2,
                            (y + 1) / 2,
                            (z + 1) / 2
                        );
                    }
                    break;
                    
                case "cone":
                    // Cone shape - points distributed on a cone
                    for (let i = 0; i < 2000; i++) {
                        const theta = Math.random() * Math.PI * 2;
                        const h = Math.random();
                        const r = h * 0.5; // Radius decreases with height
                        
                        const x = r * Math.cos(theta);
                        const y = h * 2 - 1; // Adjust to center at origin
                        const z = r * Math.sin(theta);
                        
                        points.push(x, y, z);
                        colors.push(
                            (x + 1) / 2,
                            (y + 1) / 2,
                            (z + 1) / 2
                        );
                    }
                    break;
                    
                case "torus":
                    // Torus shape - points distributed on a torus
                    for (let i = 0; i < 2000; i++) {
                        const theta = Math.random() * Math.PI * 2;
                        const phi = Math.random() * Math.PI * 2;
                        const R = 1; // Major radius
                        const r = 0.3; // Minor radius
                        
                        const x = (R + r * Math.cos(phi)) * Math.cos(theta);
                        const y = r * Math.sin(phi);
                        const z = (R + r * Math.cos(phi)) * Math.sin(theta);
                        
                        points.push(x, y, z);
                        colors.push(
                            (x + 1) / 2,
                            (y + 1) / 2,
                            (z + 1) / 2
                        );
                    }
                    break;
            }
            
            const geometry = new THREE.BufferGeometry();
            geometry.setAttribute('position', new THREE.Float32BufferAttribute(points, 3));
            geometry.setAttribute('color', new THREE.Float32BufferAttribute(colors, 3));
            
            const material = new THREE.PointsMaterial({
                size: 0.03,
                vertexColors: true,
                sizeAttenuation: true
            });
            
            pointCloud = new THREE.Points(geometry, material);
            scene.add(pointCloud);
            
            document.getElementById('render-status').textContent = `${shape.charAt(0).toUpperCase() + shape.slice(1)} point cloud generated with ${points.length/3} points`;
        }
        
        // Simulate the scanning process
        function startScanning() {
            if (isScanning) return;
            
            if (!videoStream) {
                document.getElementById('status').textContent = 'Please start the camera first';
                return;
            }
            
            isScanning = true;
            scanProgress = 0;
            captureCount = 0;
            document.getElementById('status').textContent = 'Scanning...';
            
            // Reset capture points UI
            for (let i = 1; i <= 5; i++) {
                document.getElementById(`point-${i}`).classList.remove('active');
            }
            
            const progressBar = document.getElementById('scan-progress');
            const scanInterval = setInterval(() => {
                captureCount++;
                
                // Update capture points UI
                document.getElementById(`point-${captureCount}`).classList.add('active');
                
                // Update progress
                scanProgress += 20;
                progressBar.style.width = scanProgress + '%';
                
                if (captureCount >= 5) {
                    clearInterval(scanInterval);
                    document.getElementById('status').textContent = 'Processing captured data...';
                    
                    // Generate the 3D model after a short delay
                    setTimeout(() => {
                        generatePointCloud(selectedShape);
                        document.getElementById('status').textContent = 'Point Cloud Generated!';
                        isScanning = false;
                    }, 1000);
                }
            }, 500);
        }
        
        // Export the point cloud
        function exportPointCloud() {
            if (!pointCloud) {
                alert('No point cloud to export. Please scan an object first.');
                return;
            }
            
            alert(`Point cloud data for ${selectedShape} would be exported in PLY format. In a real implementation, this would download the point cloud file.`);
        }
        
        // Reset the scanner
        function resetScanner() {
            if (pointCloud) {
                scene.remove(pointCloud);
                pointCloud = null;
            }
            
            // Reset capture points UI
            for (let i = 1; i <= 5; i++) {
                document.getElementById(`point-${i}`).classList.remove('active');
            }
            
            document.getElementById('scan-progress').style.width = '0%';
            document.getElementById('status').textContent = 'Ready to scan';
            document.getElementById('render-status').textContent = 'No point cloud generated yet';
            isScanning = false;
        }
        
        // Set up event listeners when the page loads
        window.addEventListener('load', function() {
            // Initialize the 3D preview
            init3DPreview();
            
            // Set up scanner buttons
            document.getElementById('start-btn').addEventListener('click', startCamera);
            document.getElementById('scan-btn').addEventListener('click', startScanning);
            document.getElementById('reset-btn').addEventListener('click', resetScanner);
            document.getElementById('export-btn').addEventListener('click', exportPointCloud);
            
            // Set up object selection buttons
            const objectButtons = document.querySelectorAll('.object-btn');
            objectButtons.forEach(button => {
                button.addEventListener('click', function() {
                    objectButtons.forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                    selectedShape = this.getAttribute('data-shape');
                    document.getElementById('status').textContent = `Selected: ${selectedShape}`;
                });
            });
        });
        
        // Handle window resize
        window.addEventListener('resize', () => {
            if (camera && renderer) {
                camera.aspect = 
                    document.getElementById('preview-canvas').offsetWidth / 
                    document.getElementById('preview-canvas').offsetHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(
                    document.getElementById('preview-canvas').offsetWidth,
                    document.getElementById('preview-canvas').offsetHeight
                );
            }
        });
    </script>
</body>
</html>
